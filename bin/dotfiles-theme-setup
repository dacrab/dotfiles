#!/usr/bin/env bash

set -euo pipefail

REPO_THEMES_DIR="$PWD/themes"
TARGET_THEMES_DIR="$HOME/.config/dotfiles/themes"
CURRENT_DIR="$HOME/.config/dotfiles/current"

mkdir -p "$TARGET_THEMES_DIR"
for f in "$REPO_THEMES_DIR"/*; do
  ln -snf "$f" "$TARGET_THEMES_DIR/"
done

mkdir -p "$CURRENT_DIR"
if [[ ! -L "$CURRENT_DIR/theme" ]]; then
  if [[ -d "$TARGET_THEMES_DIR/nord" ]]; then
    ln -snf "$TARGET_THEMES_DIR/nord" "$CURRENT_DIR/theme"
  else
    first_theme="$(find "$TARGET_THEMES_DIR" -mindepth 1 -maxdepth 1 -type d | head -n1 || true)"
    [[ -n "$first_theme" ]] && ln -snf "$first_theme" "$CURRENT_DIR/theme"
  fi
fi

dotfiles-theme-set "$(basename "$(realpath "$CURRENT_DIR/theme")")"

echo "Dotfiles theming is set up. Use: dotfiles-theme-set <name> or dotfiles-theme-next"


